{"paragraphs":[{"text":"%md\n###jdbc转spark sql定期离线业务统计辅助处理模板","user":"writer","dateUpdated":"2017-03-28T13:44:45+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490674908478_1710651313","id":"20170328-122148_1279101220","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>jdbc转spark sql定期离线业务统计辅助处理模板</h3>\n"},"dateCreated":"2017-03-28T12:21:48+0800","dateStarted":"2017-03-28T13:29:55+0800","dateFinished":"2017-03-28T13:29:55+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:70"},{"text":"%md\n######注：\n非标准sql函数可能不支持（三方都有自己的扩展函数）\n定期可使用该工具的run scheduler功能，见头部手表图标\n帐号先使用运营统计的writer帐号,密码找我\n多帐号要自己建notebook，不要同时操作互相干扰，相关操作不懂找我\n该工具是个分析师和平台研发工程时探测分析web辅助工具，并不能真正当作服务使用，且数据探测常会使其挂掉，经常重启\n不过天级统计，查完放redis就无需动了，类似需求可以作为辅助，减轻业务db负载\n此模板，如非确认，确勿更改,还请知晓\n\n","user":"writer","dateUpdated":"2017-03-28T16:25:50+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490678998595_468333743","id":"20170328-132958_2011422661","result":{"code":"SUCCESS","type":"HTML","msg":"<h6>注：</h6>\n<p>非标准sql函数可能不支持（三方都有自己的扩展函数）\n<br  />定期可使用该工具的run scheduler功能，见头部手表图标\n<br  />帐号先使用运营统计的writer帐号,密码找我\n<br  />多帐号要自己建notebook，不要同时操作互相干扰，相关操作不懂找我\n<br  />该工具是个分析师和平台研发工程时探测分析web辅助工具，并不能真正当作服务使用，且数据探测常会使其挂掉，经常重启\n<br  />不过天级统计，查完放redis就无需动了，类似需求可以作为辅助，减轻业务db负载\n<br  />此模板，如非确认，确勿更改,还请知晓</p>\n"},"dateCreated":"2017-03-28T13:29:58+0800","dateStarted":"2017-03-28T16:25:47+0800","dateFinished":"2017-03-28T16:25:47+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:71"},{"text":"%md\n####原jdbc举例,这里默认连tigeryun","user":"writer","dateUpdated":"2017-03-28T13:44:40+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490678502055_911456683","id":"20170328-132142_916086903","result":{"code":"SUCCESS","type":"HTML","msg":"<h4>原jdbc举例,这里默认连tigeryun</h4>\n"},"dateCreated":"2017-03-28T13:21:42+0800","dateStarted":"2017-03-28T13:22:32+0800","dateFinished":"2017-03-28T13:22:32+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:72"},{"text":"%jdbc\n/*\nselect *\nfrom ads\nlimit 10\n*/\n\nselect week(floor(ctime/1000000000),1) as zhou,sum(amount) as jine \nfrom investment_project \nwhere status=1 and type=0 and substr(ctime,1,4)=2017 \ngroup by week(floor(ctime/1000000000),1)","user":"writer","dateUpdated":"2017-05-16T17:09:08+0800","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"zhou","index":0,"aggr":"sum"}],"values":[{"name":"jine","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"zhou","index":0,"aggr":"sum"},"yAxis":{"name":"jine","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/scala","lineNumbers":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490082423229_128006467","id":"20170321-154703_1326975259","result":{"code":"SUCCESS","type":"TABLE","msg":"zhou\tjine\n0\t3687522.90\n1\t29810473.94\n2\t27441156.00\n3\t35650755.12\n4\t49376752.67\n5\t32391095.72\n6\t42451019.80\n7\t25276537.42\n8\t35373462.58\n9\t51465000.00\n10\t29785460.23\n11\t34358357.71\n12\t35354045.04\n13\t28817070.12\n14\t58703429.48\n15\t48283122.00\n16\t44398855.50\n17\t54291033.53\n18\t53892698.53\n19\t26365592.56\n20\t14887761.40\n","comment":"","msgTable":[[{"key":"jine","value":"0"},{"key":"jine","value":"3687522.90"}],[{"value":"1"},{"value":"29810473.94"}],[{"value":"2"},{"value":"27441156.00"}],[{"value":"3"},{"value":"35650755.12"}],[{"value":"4"},{"value":"49376752.67"}],[{"value":"5"},{"value":"32391095.72"}],[{"value":"6"},{"value":"42451019.80"}],[{"value":"7"},{"value":"25276537.42"}],[{"value":"8"},{"value":"35373462.58"}],[{"value":"9"},{"value":"51465000.00"}],[{"value":"10"},{"value":"29785460.23"}],[{"value":"11"},{"value":"34358357.71"}],[{"value":"12"},{"value":"35354045.04"}],[{"value":"13"},{"value":"28817070.12"}],[{"value":"14"},{"value":"58703429.48"}],[{"value":"15"},{"value":"48283122.00"}],[{"value":"16"},{"value":"44398855.50"}],[{"value":"17"},{"value":"54291033.53"}],[{"value":"18"},{"value":"53892698.53"}],[{"value":"19"},{"value":"26365592.56"}],[{"value":"20"},{"value":"14887761.40"}]],"columnNames":[{"name":"zhou","index":0,"aggr":"sum"},{"name":"jine","index":1,"aggr":"sum"}],"rows":[["0","3687522.90"],["1","29810473.94"],["2","27441156.00"],["3","35650755.12"],["4","49376752.67"],["5","32391095.72"],["6","42451019.80"],["7","25276537.42"],["8","35373462.58"],["9","51465000.00"],["10","29785460.23"],["11","34358357.71"],["12","35354045.04"],["13","28817070.12"],["14","58703429.48"],["15","48283122.00"],["16","44398855.50"],["17","54291033.53"],["18","53892698.53"],["19","26365592.56"],["20","14887761.40"]]},"dateCreated":"2017-03-21T15:47:03+0800","dateStarted":"2017-05-16T17:09:08+0800","dateFinished":"2017-05-16T17:09:10+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:73"},{"text":"%md\n####setup1:spark连rds db并注册表","user":"writer","dateUpdated":"2017-03-28T13:48:07+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490678570017_899052774","id":"20170328-132250_1758796245","result":{"code":"SUCCESS","type":"HTML","msg":"<h4>setup1:spark连rds db并注册表</h4>\n"},"dateCreated":"2017-03-28T13:22:50+0800","dateStarted":"2017-03-28T13:24:25+0800","dateFinished":"2017-03-28T13:24:25+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:74"},{"text":"val props = scala.collection.mutable.Map[String,String]();//多数据源，多表join，hivesql语法函数支持，数据量过大或速度 优化见，运营专用的大sql，大表优化\nprops+=(\"driver\" -> \"com.mysql.jdbc.Driver\")\nprops+=(\"url\" -> \"jdbc:mysql://chzbjscyq2014twotigercom.mysql.rds.aliyuncs.com:3306/tigerhuan?user=bigdata&password=tigerBDData!@#\")\nprops+=(\"dbtable\" -> \"ads\")//默认一个rdd分区，可通过以下优化：\n// //sql 是查询语句，此查询语句必须包含两处占位符?来作为分割数据库ResulSet的参数，例如：\"select title, author from books where ? < = id and id <= ?\"\n// props+=(\"partitionColumn\" -> \"id\")//分区字段，须数字类型\n// props+=(\"lowerBound\" -> \"0\")//分区下界\n// props+=(\"upperBound\" -> \"100\")\n// //owerBound, upperBound, numPartitions 分别为第一、第二占位符，partition的个数。例如，给出lowebound 1，upperbound 20， numpartitions 2，则查询分别为(1, 10)与(11, 20)\n// props+=(\"numPartitions\" -> \"2\")//分区数\nimport scala.collection.JavaConverters._\n \nval jdbcDF = sqlContext.load(\"jdbc\", props.asJava)\njdbcDF.first\njdbcDF.registerTempTable(\"ads\")\nval lineCount=sqlContext.sql(\"\"\"\nselect count(*) as lineCount,min(id) min,max(id) max \nfrom ads\n\"\"\")","user":"ljj","dateUpdated":"2017-06-19T18:11:56+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490672092729_-51773659","id":"20170328-113452_2088659343","result":{"code":"SUCCESS","type":"TEXT","msg":"props: scala.collection.mutable.Map[String,String] = Map()\nres0: props.type = Map(driver -> com.mysql.jdbc.Driver)\nres1: props.type = Map(driver -> com.mysql.jdbc.Driver, url -> jdbc:mysql://chzbjscyq2014twotigercom.mysql.rds.aliyuncs.com:3306/tigerhuan?user=bigdata&password=tigerBDData!@#)\nres2: props.type = Map(dbtable -> ads, driver -> com.mysql.jdbc.Driver, url -> jdbc:mysql://chzbjscyq2014twotigercom.mysql.rds.aliyuncs.com:3306/tigerhuan?user=bigdata&password=tigerBDData!@#)\nimport scala.collection.JavaConverters._\nwarning: there were 1 deprecation warning(s); re-run with -deprecation for details\njdbcDF: org.apache.spark.sql.DataFrame = [id: bigint, title: string, pic: string, url: string, position: int, startTime: bigint, endTime: bigint, status: int, ctime: bigint, timestamp: bigint]\nres3: org.apache.spark.sql.Row = [1,1月运营报告,/data/banner/2016/02/04/1454560612326_12DF53FEA8B3ADFA6C2EC456DD22E204.jpg,/topic/reportyy,81,20160301000000000,20170304202500000,0,20141201210125466,20160304202243476]\nlineCount: org.apache.spark.sql.DataFrame = [lineCount: bigint, min: bigint, max: bigint]\n"},"dateCreated":"2017-03-28T11:34:52+0800","dateStarted":"2017-06-19T18:11:56+0800","dateFinished":"2017-06-19T18:12:27+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:75"},{"text":"%md\n####setup2:分步式sql调试简单图表自动展示","user":"ljj","dateUpdated":"2017-03-28T16:19:21+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490678675467_1058893778","id":"20170328-132435_1665485303","result":{"code":"SUCCESS","type":"HTML","msg":"<h4>setup2:分步式sql调试简单图表自动展示</h4>\n"},"dateCreated":"2017-03-28T13:24:35+0800","dateStarted":"2017-03-28T16:19:19+0800","dateFinished":"2017-03-28T16:19:19+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:76"},{"text":"%sql\nselect count(*) as lineCount,min(id) min,max(id) max from ads\n-- select week(floor(ctime/1000000000),1) as zhou,sum(amount) as jine \n-- from investment_project \n-- where status=1 and type=0 and substr(ctime,1,4)=2017 \n-- group by week(floor(ctime/1000000000),1)\n","user":"ljj","dateUpdated":"2017-03-28T16:16:44+0800","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"lineCount","index":0,"aggr":"sum"}],"values":[{"name":"lineCount","index":0,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"lineCount","index":0,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490673613806_17530700","id":"20170328-120013_1447417355","result":{"code":"SUCCESS","type":"TABLE","msg":"lineCount\tmin\tmax\n75\t1\t86\n","comment":"","msgTable":[[{"key":"min","value":"75"},{"key":"min","value":"1"},{"key":"min","value":"86"}]],"columnNames":[{"name":"lineCount","index":0,"aggr":"sum"},{"name":"min","index":1,"aggr":"sum"},{"name":"max","index":2,"aggr":"sum"}],"rows":[["75","1","86"]]},"dateCreated":"2017-03-28T12:00:13+0800","dateStarted":"2017-03-28T16:16:44+0800","dateFinished":"2017-03-28T16:16:44+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:77"},{"text":"%md\n#####setup3:结果存储至mysql redis,mongodb","user":"ljj","dateUpdated":"2017-06-19T21:51:10+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490678757925_-992140789","id":"20170328-132557_530229392","result":{"code":"SUCCESS","type":"HTML","msg":"<h5>setup3:结果存储至mysql redis,mongodb</h5>\n"},"dateCreated":"2017-03-28T13:25:57+0800","dateStarted":"2017-06-19T21:51:07+0800","dateFinished":"2017-06-19T21:51:07+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:78","focus":true},{"text":"//mysql 自己插入,或参照https://www.iteblog.com/archives/1290.html\n//注意：rds请用自己的帐号，这里数据是测试号，mysql只读，redise随时可能被清\n  //定义mysql输出库信息，类似读取维度表  \n    val props = scala.collection.mutable.Map[String, String]();\n    props += (\"driver\" -> \"com.mysql.jdbc.Driver\")\n    props += (\"url\" -> \"jdbc:mysql://172.16.2.114:3306/test?user=root&password=EMRroot1234\") //拉取维度数据源 做跨平台 跨数据源分析\n    props += (\"dbtable\" -> \"date_dim\") //默认一个rdd分区，可通过以下优化：\n    // //sql 是查询语句，此查询语句必须包含两处占位符?来作为分割数据库ResulSet的参数，例如：\"select title, author from books where ? < = id and id <= ?\"\n    // props+=(\"partitionColumn\" -> \"id\")//分区字段，须数字类型\n    // props+=(\"lowerBound\" -> \"0\")//分区下界\n    // props+=(\"upperBound\" -> \"100\")\n    // //owerBound, upperBound, numPartitions 分别为第一、第二占位符，partition的个数。例如，给出lowebound 1，upperbound 20， numpartitions 2，则查询分别为(1, 10)与(11, 20)\n    // props+=(\"numPartitions\" -> \"2\")//分区数\n    import scala.collection.JavaConverters._\n\n    // var jdbcDF = sqlContext.load(\"jdbc\", props.asJava) //加载数据\n    val jdbcDF = sqlContext.read.format(\"jdbc\").options(props).load()//方法二\n    //方法3：\n    // import java.util.Properties\n    // val url=\"jdbc:mysql://chzbjscyq2014twotigercom.mysql.rds.aliyuncs.com:3306/tigerhuan?user=bigdata&password=tigerBDData!@#\"\n    // val prop = new Properties()\n    // prop.setProperty(\"driver\",\"com.mysql.jdbc.Driver\")\n    // val jdbcDF=sqlContext.read.jdbc(url,\"ads\",prop)\n\n    // jdbcDF.first\n    // jdbcDF.cache //OOM\n    // import org.apache.spark.storage.StorageLevel\n    // jdbcDF.persist(StorageLevel.MEMORY_AND_DISK_SER)\n\n    jdbcDF.registerTempTable(\"date_dim\") //注册表\n    // sqlContext.cacheTable(\"customer_activity\")\n    sqlContext.cacheTable(\"date_dim\") //缓存表\n    //    sqlContext.sql(\"select * from date_dim limit 1\").show\n    //   指标结果写入方法一：\n//   import org.apache.spark.sql._\n//   lineCount.write.format(\"jdbc\").mode(SaveMode.Append).options(props).save()//须预先创建表\n  \n    //   指标结果写入方法二：（推荐：代码少，表没有会自动创建，注意SaveMode写入模式）\n    import java.util.Properties\n    val url=\"jdbc:mysql://172.16.2.114:3306/test?user=root&password=EMRroot1234\"  \n    val prop=new Properties()  \n    // prop.setProperty(\"user\",\"root\")  \n    // prop.setProperty(\"password\",\"EMRroot1234\")  \n    // lineCount.write.mode(SaveMode.Overwrite).jdbc(url,\"zbh_test\",prop) \n    lineCount.write.mode(SaveMode.Append).jdbc(url,\"zbh_test\",prop) ","user":"ljj","dateUpdated":"2017-06-19T21:45:45+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490689209584_1303673546","id":"20170328-162009_82503767","result":{"code":"SUCCESS","type":"TEXT","msg":"props: scala.collection.mutable.Map[String,String] = Map()\nres104: props.type = Map(driver -> com.mysql.jdbc.Driver)\nres105: props.type = Map(driver -> com.mysql.jdbc.Driver, url -> jdbc:mysql://172.16.2.114:3306/test?user=root&password=EMRroot1234)\nres106: props.type = Map(dbtable -> date_dim, driver -> com.mysql.jdbc.Driver, url -> jdbc:mysql://172.16.2.114:3306/test?user=root&password=EMRroot1234)\nimport scala.collection.JavaConverters._\njdbcDF: org.apache.spark.sql.DataFrame = [date: date, id: int, y: int, m: int, d: int, w: int, q: int, yesterday: date, 7days_ago: date, 30days_ago: date, m_name: string, w_name: string]\nimport java.util.Properties\nurl: String = jdbc:mysql://172.16.2.114:3306/test?user=root&password=EMRroot1234\nprop: java.util.Properties = {}\n"},"dateCreated":"2017-03-28T16:20:09+0800","dateStarted":"2017-06-19T19:07:44+0800","dateFinished":"2017-06-19T19:07:46+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:564"},{"text":"import org.apache.commons.pool2.impl.GenericObjectPoolConfig\nimport redis.clients.jedis.JedisPool\n    \nobject RedisClient extends Serializable {\n    val redisHost = \"r-2ze9249bfd33e674.redis.rds.aliyuncs.com\"\n    val redisPort = 6379\n    val redisTimeout = 30000\n    val passwd=\"tigerReData1\"\n    lazy val pool = new JedisPool(new GenericObjectPoolConfig(), redisHost, redisPort, redisTimeout,passwd)\n\n    lazy val hook = new Thread {\n      override def run = {\n        println(\"Execute hook thread: \" + this)\n        pool.destroy()\n      }\n    }\n    sys.addShutdownHook(hook.run)\n  }\n   \n    val dbIndex = 1\n    val clickHashKey = \"app::users::click\"\n    val uid = \"001\"\n    val clickCount = 2\n    val jedis = RedisClient.pool.getResource\n    jedis.select(dbIndex)\n    jedis.hincrBy(clickHashKey, uid, clickCount)\n    RedisClient.pool.returnResource(jedis)\n   \n","dateUpdated":"2017-03-28T13:27:43+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490678847450_-268273221","id":"20170328-132727_233478848","dateCreated":"2017-03-28T13:27:27+0800","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:79","focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497878985743_-2020584152","id":"20170619-212945_1420387985","dateCreated":"2017-06-19T21:29:45+0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:937","text":"import com.stratio.datasource.mongodb._\nimport com.stratio.datasource.mongodb.config._\nimport com.stratio.datasource.mongodb.config.MongodbConfig._\n\nimport org.apache.spark.sql._\nimport org.apache.spark.sql.SQLContext\nimport org.apache.spark.sql.types.{IntegerType, StringType, StructField, StructType}\nimport sqlContext.implicits._\nimport java.text.SimpleDateFormat\nimport org.joda.time.format._\nimport org.joda.time._\n \nimport java.sql.Timestamp\nval opt=Map(Host ->\"dds-2ze629d32df5dd941.mongodb.rds.aliyuncs.com:3717\", Database -> \"lzlh\",Collection -> \"track-pageview\",\"credentials\"-> \"root,admin,mongo2tiger\")\n\ndef ISODateToSqlDate (s:String):Timestamp={//自定义函数\n    var sdf:SimpleDateFormat = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\")\n    Timestamp.valueOf(sdf.format(ISODateTimeFormat.dateTimeNoMillis().withZone(DateTimeZone.getDefault()).parseDateTime(s).toDate))\n}\n\n// val da3=da2.map(s=>{(ISODateToSqlDate(s.getAs[String](\"timestamp\")),\"\"+s(0))})\n// da3.toDF(\"timestamp\",\"date\").show\n\nsqlContext.udf.register(\"ISODateToSqlDate\", (s: String) => ISODateToSqlDate(s))\nval da1=sqlContext.sql(\"select ISODateToSqlDate(timestamp) st,* from data\")\nda1.write.format(\"com.stratio.datasource.mongodb\").mode(SaveMode.Append).options(opt).save()\nval res1=sqlContext.read.format(\"com.stratio.datasource.mongodb\").options(opt).load\nres1.show","dateUpdated":"2017-06-19T21:30:22+0800"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497878858649_-991951127","id":"20170619-212738_2022380311","dateCreated":"2017-06-19T21:27:38+0800","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:638","text":"%md\n###速度优化","user":"ljj","dateUpdated":"2017-06-19T21:28:10+0800","dateFinished":"2017-06-19T21:28:07+0800","dateStarted":"2017-06-19T21:28:06+0800","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>速度优化</h3>\n"}},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497880229257_-174000681","id":"20170619-215029_1858237485","dateCreated":"2017-06-19T21:50:29+0800","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1771","text":"%md\n###案例二","user":"ljj","dateUpdated":"2017-06-19T21:50:35+0800","dateFinished":"2017-06-19T21:50:32+0800","dateStarted":"2017-06-19T21:50:32+0800","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>案例二</h3>\n"}},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497878892643_-1026331697","id":"20170619-212812_1404166434","dateCreated":"2017-06-19T21:28:12+0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:727","text":"%jdbc--大sql优化：mysql的二分到spark的秒级\nselect t1.customerid,t1.jine1 转入,t1.jine2 转出,t1.jingzhuanru 净转入,t2.jine 充值,t3.jine 提现,ifnull(t2.jine,0)-ifnull(t3.jine,0) 净充值,\nt4.jine 投资,t5.jine 回款,t6.accountAmount 活期,t7.collectedCapital 待收,t7.totalInvestment 累计投资 from \n(select customerid,sum(case when type=1 then amount end) jine1,sum(case when type=2 then amount end) jine2,\nifnull(sum(case when type=1 then amount end),0)-ifnull(sum(case when type=2 then amount end),0) jingzhuanru\nfrom customer_asset_x_log where customerId<>3683 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502\ngroup by customerid) t1\nleft join \n(select customerid,sum(amount) jine from customer_asset_inpour where status=1 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid    ) t2\non t1.customerid=t2.customerid\nleft join \n(select customerid,sum(amount) jine from customer_asset_draw where status>0 and  substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid) t3\non t1.customerid=t3.customerid\nleft join \n(select customerid,sum(amount) jine from investment_project where status=1 and type=0 and isx=0 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid) t4\non t1.customerid=t4.customerid\nleft join \n(select customerid ,sum(capital+interest) jine from investment_repayment where substr(realtime,1,8)>=20170502 and substr(realtime,1,8)<=20170502 \nand projectid in (select id from project where isx=0) group by customerid) t5\non t1.customerid=t5.customerid\nleft join \n(select * from (select * from customer_asset_x_log where substr(ctime,1,8)<=20170502 order by id desc) a group by customerid) t6\non t1.customerid=t6.customerId\nleft join \n(select * from (select * from customer_asset_log where substr(ctime,1,8)<=20170502 order by id desc) a group by customerid) t7\non t1.customerid =t7.customerid","dateUpdated":"2017-06-19T21:28:43+0800"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497878916382_1358387958","id":"20170619-212836_2003548626","dateCreated":"2017-06-19T21:28:36+0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:797","text":"val props = scala.collection.mutable.Map[String,String]();\nprops+=(\"driver\" -> \"com.mysql.jdbc.Driver\")\nprops+=(\"url\" -> \"jdbc:mysql://chzbjscyq2014twotigercom.mysql.rds.aliyuncs.com:3306/tigerhuan?user=bigdata&password=tigerBDData!@#\")//1.修改连接信息和表\nprops+=(\"dbtable\" -> \"customer_asset_x_log\")//默认一个rdd分区，可通过以下优化：\n// //sql 是查询语句，此查询语句必须包含两处占位符?来作为分割数据库ResulSet的参数，例如：\"select title, author from books where ? < = id and id <= ?\"\n// props+=(\"partitionColumn\" -> \"id\")//分区字段，须数字类型\n// props+=(\"lowerBound\" -> \"0\")//分区下界\n// props+=(\"upperBound\" -> \"100\")\n// //owerBound, upperBound, numPartitions 分别为第一、第二占位符，partition的个数。例如，给出lowebound 1，upperbound 20， numpartitions 2，则查询分别为(1, 10)与(11, 20)\n// props+=(\"numPartitions\" -> \"2\")//分区数\nimport scala.collection.JavaConverters._\n \nval jdbcDF = sqlContext.load(\"jdbc\", props.asJava)//加载注册多表\njdbcDF.registerTempTable(\"customer_asset_x_log\")\njdbcDF.first\nprops+=(\"dbtable\" -> \"customer_asset_inpour\")\nval jdbcDF = sqlContext.load(\"jdbc\", props.asJava)\njdbcDF.registerTempTable(\"customer_asset_inpour\")\njdbcDF.first\nprops+=(\"dbtable\" -> \"customer_asset_draw\")\nval jdbcDF = sqlContext.load(\"jdbc\", props.asJava)\njdbcDF.registerTempTable(\"customer_asset_draw\")\njdbcDF.first\nprops+=(\"dbtable\" -> \"investment_project\")\nval jdbcDF = sqlContext.load(\"jdbc\", props.asJava)\njdbcDF.registerTempTable(\"investment_project\")\n// jdbcDF.first\n// props+=(\"dbtable\" -> \"investment_repayment\")\n// val jdbcDF = sqlContext.load(\"jdbc\", props.asJava)\n// jdbcDF.registerTempTable(\"investment_repayment\")\n// jdbcDF.first\n// props+=(\"dbtable\" -> \"project\")\n// val jdbcDF = sqlContext.load(\"jdbc\", props.asJava)\n// jdbcDF.registerTempTable(\"project\")\n// jdbcDF.first\nprops+=(\"dbtable\" -> \"customer_asset_log\")\nval jdbcDF = sqlContext.load(\"jdbc\", props.asJava)\njdbcDF.registerTempTable(\"customer_asset_log\")\n// val res=sqlContext.sql(\"\"\"\n// select t1.customerid,t1.jine1 zhuan_ru,t1.jine2 zhuan_chu,t1.jingzhuanru jing_zhuan_ru,t2.jine chong_zhi,t3.jine ti_xian, t2.jine-t3.jine jing_chong_zhi from (\n//     select customerid,sum(case when type=1 then amount end) jine1,sum(case when type=2 then amount end) jine2,\n//     sum(case when type=1 then amount end)-sum(case when type=2 then amount end) jingzhuanru\n//     from customer_asset_x_log \n//     where customerId<>3683 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502\n//     group by customerid) t1\n// left join \n// (select customerid ,sum(amount) jine from customer_asset_inpour where status=1 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid) t2\n// on t1.customerid=t2.customerid\n// left join \n// (select customerid ,sum(amount) jine from customer_asset_draw where status>0 and  substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid) t3\n// on t1.customerid=t3.customerid\n// left join \n// (select customerid,sum(amount) jine from investment_project where status=1 and type=0 and isx=0 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid) t4\n// on t1.customerid=t4.customerid\n// left join --记录太多OOM\n// (select customerid ,sum(capital+interest) jine from investment_repayment where substr(realtime,1,8)>=20170502 and substr(realtime,1,8)<=20170502 \n// and projectid in (select id from project where isx=0) group by customerid) t5\n// on t1.customerid=t5.customerid\n// \"\"\")\n//hive sql 语法参考ifnull, 汉字不支持 http://www.cnblogs.com/end/archive/2012/06/18/2553683.html\n// --变量定义参考 1.6.x不支持 http://blog.csdn.net/harli_xxy/article/details/52250431 http://blog.163.com/hevensun@126/blog/static/201533632015526113843891/\n// -- hive 1.x 不支持存储过程http://www.tuicool.com/articles/m2mIFj \n\n// val res=sqlContext.sql(\"\"\"\n// select t1.customerid,t1.jine1 zhuan_ru,t1.jine2 zhuan_chu,t1.jingzhuanru jing_zhuan_ru,t2.jine chong_zhi,t3.jine ti_xian,ifnull(t2.jine,0)-ifnull(t3.jine,0) jing_chong_zhi,\n// t4.jine tou_zi,t5.jine hui_kuan,t6.accountAmount huo_qi,t7.collectedCapital dai_shou,t7.totalInvestment lei_ji_tou_zi from \n// (select customerid,sum(case when type=1 then amount end) jine1,sum(case when type=2 then amount end) jine2,\n// ifnull(sum(case when type=1 then amount end),0)-ifnull(sum(case when type=2 then amount end),0) jingzhuanru\n// from customer_asset_x_log where customerId<>3683 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502\n// group by customerid) t1\n// left join \n// (select customerid,sum(amount) jine from customer_asset_inpour where status=1 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid    ) t2\n// on t1.customerid=t2.customerid\n// left join \n// (select customerid,sum(amount) jine from customer_asset_draw where status>0 and  substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid) t3\n// on t1.customerid=t3.customerid\n// left join \n// (select customerid,sum(amount) jine from investment_project where status=1 and type=0 and isx=0 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid) t4\n// on t1.customerid=t4.customerid\n// left join \n// (select customerid ,sum(capital+interest) jine from investment_repayment where substr(realtime,1,8)>=20170502 and substr(realtime,1,8)<=20170502 \n// and projectid in (select id from project where isx=0) group by customerid) t5\n// on t1.customerid=t5.customerid\n// left join \n// (select * from (select * from customer_asset_x_log where substr(ctime,1,8)<=20170502 order by id desc) a group by customerid) t6\n// on t1.customerid=t6.customerId\n// left join \n// (select * from (select * from customer_asset_log where substr(ctime,1,8)<=20170502 order by id desc) a group by customerid) t7\n// on t1.customerid =t7.customerid\n// \"\"\")\n\nval res=sqlContext.sql(\"\"\"\nselect t1.customerid,t1.jine1 zhuan_ru,t1.jine2 zhuan_chu,t1.jingzhuanru jing_zhuan_ru\n        ,t2.jine chong_zhi,t3.jine ti_xian, t2.jine-t3.jine jing_chong_zhi \n        ,t4.jine tou_zi\n        --,t5.jine hui_kuan \n        ,t6.accountAmount huo_qi\n        ,t7.collectedCapital dai_shou,t7.totalInvestment lei_ji_tou_zi\nfrom (select customerid,\n    if(sum(case when type=1 then amount end) IS NULL,0,sum(case when type=1 then amount end)) jine1,-- ifnull函数不支持,替成if is null或case when\n    case when sum(case when type=2 then amount end)=null then 0 else sum(case when type=2 then amount end) end jine2,\n    sum(case when type=1 then amount end)-sum(case when type=2 then amount end) jingzhuanru\n    from customer_asset_x_log where customerId<>3683 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502\n    group by customerid) t1\n    left join \n(select customerid,sum(amount) jine from customer_asset_inpour where status=1 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid    ) t2\non t1.customerid=t2.customerid\nleft join \n(select customerid,sum(amount) jine from customer_asset_draw where status>0 and  substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid) t3\non t1.customerid=t3.customerid\nleft join \n(select customerid,sum(amount) jine from investment_project where status=1 and type=0 and isx=0 and substr(ctime,1,8)>=20170502 and substr(ctime,1,8)<=20170502 group by customerid) t4\non t1.customerid=t4.customerid\n--left join \n--(select customerid ,sum(capital+interest) jine from investment_repayment where substr(realtime,1,8)>=20170502 and substr(realtime,1,8)<=20170502 \n--and projectid in (select id from project where isx=0) group by customerid) t5\n--on t1.customerid=t5.customerid\nleft join --语法：要加first函数\n(select customerid, first(accountAmount) accountAmount from (select * from customer_asset_x_log where substr(ctime,1,8)<=20170502 order by id desc) a group by customerid) t6\non t1.customerid=t6.customerId\nleft join \n(select customerid, first(collectedCapital) collectedCapital, first(totalInvestment) totalInvestment from (select * from customer_asset_log where substr(ctime,1,8)<=20170502 order by id desc) a group by customerid) t7\non t1.customerid =t7.customerid\n\"\"\")\n\nres.show\nres.registerTempTable(\"res\")","dateUpdated":"2017-06-19T21:29:13+0800"},{"text":"%md\n###案例二","user":"ljj","dateUpdated":"2017-06-19T21:50:12+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497880181771_-986867837","id":"20170619-214941_333533423","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>案例二</h3>\n"},"dateCreated":"2017-06-19T21:49:41+0800","dateStarted":"2017-06-19T21:50:02+0800","dateFinished":"2017-06-19T21:50:02+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1705"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497878948701_1807051148","id":"20170619-212908_1668315050","dateCreated":"2017-06-19T21:29:08+0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:867","text":"val props = scala.collection.mutable.Map[String,String]();\nprops+=(\"driver\" -> \"com.mysql.jdbc.Driver\")\nprops+=(\"url\" -> \"jdbc:mysql://chzbjscyq2014twotigercom.mysql.rds.aliyuncs.com:3306/tigerhuan?user=bigdata&password=tigerBDData!@#\")//配置连接信息\nprops+=(\"dbtable\" -> \"customer_activity\")//默认一个rdd分区，可通过以下优化：\n// //sql 是查询语句，此查询语句必须包含两处占位符?来作为分割数据库ResulSet的参数，例如：\"select title, author from books where ? < = id and id <= ?\"\n// props+=(\"partitionColumn\" -> \"id\")//分区字段，须数字类型\n// props+=(\"lowerBound\" -> \"0\")//分区下界\n// props+=(\"upperBound\" -> \"100\")\n// //owerBound, upperBound, numPartitions 分别为第一、第二占位符，partition的个数。例如，给出lowebound 1，upperbound 20， numpartitions 2，则查询分别为(1, 10)与(11, 20)\n// props+=(\"numPartitions\" -> \"2\")//分区数\nimport scala.collection.JavaConverters._\n \nval jdbcDF = sqlContext.load(\"jdbc\", props.asJava)//加载数据\n// jdbcDF.first\n// jdbcDF.cache //OOM\n// import org.apache.spark.storage.StorageLevel \n// jdbcDF.persist(StorageLevel.MEMORY_AND_DISK_SER)\n\njdbcDF.registerTempTable(\"customer_activity\")//注册表\n// sqlContext.cacheTable(\"customer_activity\")","dateUpdated":"2017-06-19T21:31:55+0800"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497879121096_901765990","id":"20170619-213201_1829033048","dateCreated":"2017-06-19T21:32:01+0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1007","text":"%sql --数据太多至OOM内存溢出\nselect sum(case when awardType in (5,0) and status=1 then valuation end) xianjin,\nsum(case when awardType=4 and status=1 then valuation end) daijin\nfrom customer_activity where substr(ctime,1,6)=201704 AND nid LIKE 'vip_award%'","dateUpdated":"2017-06-19T21:32:12+0800"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497879137579_-1045048120","id":"20170619-213217_47518","dateCreated":"2017-06-19T21:32:17+0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1077","text":"val res=sqlContext.sql(\"\"\"\nselect nid,awardType,status,valuation,ctime from customer_activity where status=1 and awardType in (5,4,0) and substr(ctime,1,6)=201704 AND nid LIKE 'vip_award%' --检索需要字段 \n\"\"\")\nres.registerTempTable(\"customer_activity\")//检索需要字段结果为表\n// sqlContext.uncacheTable(\"customer_activity\")\nsqlContext.cacheTable(\"customer_activity\")//缓存备多次使用，无需重新加载数据 \nres.show","dateUpdated":"2017-06-19T21:32:30+0800"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497879159382_580762814","id":"20170619-213239_1393272379","dateCreated":"2017-06-19T21:32:39+0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1147","text":"val res=sqlContext.sql(\"\"\"\nselect sum(case when awardType in (5,0) and status=1 then valuation end) xianjin,--原sql执行变秒级\nsum(case when awardType=4 and status=1 then valuation end) daijin\nfrom customer_activity where substr(ctime,1,6)=201704 --这个日期想想用维表join，比每条做运算要快\nAND nid LIKE 'vip_award%'\n\"\"\")\n\nres.show","dateUpdated":"2017-06-19T21:32:50+0800"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497880145830_1395081955","id":"20170619-214905_1898114000","dateCreated":"2017-06-19T21:49:05+0800","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1535","text":"%md\n###维度表建立访问","user":"ljj","dateUpdated":"2017-06-19T21:50:02+0800","dateFinished":"2017-06-19T21:50:02+0800","dateStarted":"2017-06-19T21:50:02+0800","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>维度表建立访问</h3>\n"}},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497879192487_1011727555","id":"20170619-213312_189237445","dateCreated":"2017-06-19T21:33:12+0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1217","text":"val props = scala.collection.mutable.Map[String,String]();\nprops+=(\"driver\" -> \"com.mysql.jdbc.Driver\")\nprops+=(\"url\" -> \"jdbc:mysql://127.0.0.1:3306/test?user=root&password=EMRroot1234\")//拉取维度数据源 做跨平台 跨数据源分析\nprops+=(\"dbtable\" -> \"date_dim\")//默认一个rdd分区，可通过以下优化：\n// //sql 是查询语句，此查询语句必须包含两处占位符?来作为分割数据库ResulSet的参数，例如：\"select title, author from books where ? < = id and id <= ?\"\n// props+=(\"partitionColumn\" -> \"id\")//分区字段，须数字类型\n// props+=(\"lowerBound\" -> \"0\")//分区下界\n// props+=(\"upperBound\" -> \"100\")\n// //owerBound, upperBound, numPartitions 分别为第一、第二占位符，partition的个数。例如，给出lowebound 1，upperbound 20， numpartitions 2，则查询分别为(1, 10)与(11, 20)\n// props+=(\"numPartitions\" -> \"2\")//分区数\nimport scala.collection.JavaConverters._\n \nval jdbcDF = sqlContext.load(\"jdbc\", props.asJava)//加载数据\n// jdbcDF.first\n// jdbcDF.cache //OOM\n// import org.apache.spark.storage.StorageLevel \n// jdbcDF.persist(StorageLevel.MEMORY_AND_DISK_SER)\n\njdbcDF.registerTempTable(\"date_dim\")//注册表\n// sqlContext.cacheTable(\"customer_activity\")\nsqlContext.cacheTable(\"date_dim\")//缓存表\nsqlContext.sql(\"select * from date_dim limit 1\").show","dateUpdated":"2017-06-19T21:33:23+0800"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497879253486_1059329149","id":"20170619-213413_1220863953","dateCreated":"2017-06-19T21:34:13+0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1287","text":"val props = scala.collection.mutable.Map[String,String]();\nprops+=(\"driver\" -> \"com.mysql.jdbc.Driver\")\nprops+=(\"url\" -> \"jdbc:mysql://127.0.0.1:3306/test?user=root&password=EMRroot1234\")//拉取维度数据源 做跨平台 跨数据源分析\nprops+=(\"dbtable\" -> \"date_dim\")//默认一个rdd分区，可通过以下优化：\n// //sql 是查询语句，此查询语句必须包含两处占位符?来作为分割数据库ResulSet的参数，例如：\"select title, author from books where ? < = id and id <= ?\"\n// props+=(\"partitionColumn\" -> \"id\")//分区字段，须数字类型\n// props+=(\"lowerBound\" -> \"0\")//分区下界\n// props+=(\"upperBound\" -> \"100\")\n// //owerBound, upperBound, numPartitions 分别为第一、第二占位符，partition的个数。例如，给出lowebound 1，upperbound 20， numpartitions 2，则查询分别为(1, 10)与(11, 20)\n// props+=(\"numPartitions\" -> \"2\")//分区数\nimport scala.collection.JavaConverters._\n \nval jdbcDF = sqlContext.load(\"jdbc\", props.asJava)//加载数据\n// jdbcDF.first\n// jdbcDF.cache //OOM\n// import org.apache.spark.storage.StorageLevel \n// jdbcDF.persist(StorageLevel.MEMORY_AND_DISK_SER)\n\njdbcDF.registerTempTable(\"date_dim\")//注册表\n// sqlContext.cacheTable(\"customer_activity\")\nsqlContext.cacheTable(\"date_dim\")//缓存表\nsqlContext.sql(\"select * from date_dim limit 1\").show","dateUpdated":"2017-06-19T21:34:25+0800"},{"text":"%md\n## Welcome to Zeppelin on Aliyun E-MapReduce.\n##### This is a live tutorial, you can run the code yourself. (Shift-Enter to Run)","dateUpdated":"2017-03-20T11:12:36+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"editorHide":true,"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1423836981412_-1007008116","id":"20150213-231621_168813393","result":{"code":"SUCCESS","type":"HTML","msg":"<h2>Welcome to Zeppelin on Aliyun E-MapReduce.</h2>\n<h5>This is a live tutorial, you can run the code yourself. (Shift-Enter to Run)</h5>\n"},"dateCreated":"2015-02-13T23:16:21+0800","dateStarted":"2015-04-01T21:11:09+0800","dateFinished":"2015-04-01T21:11:10+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:81"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497880108778_-1759367008","id":"20170619-214828_2061102015","dateCreated":"2017-06-19T21:48:28+0800","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1441","text":"%md\n###excel处理","user":"ljj","dateUpdated":"2017-06-19T21:49:27+0800","dateFinished":"2017-06-19T21:49:27+0800","dateStarted":"2017-06-19T21:49:27+0800","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>excel处理</h3>\n"}},{"title":"Load data into table","text":"import org.apache.commons.io.IOUtils\nimport java.net.URL\nimport java.nio.charset.Charset\n\n// Zeppelin creates and injects sc (SparkContext) and sqlContext (HiveContext or SqlContext)\n// So you don't need create them manually\n\n// load bank data\nval bankText = sc.parallelize(\n    IOUtils.toString(\n        new URL(\"http://emr-sample-projects.oss-cn-hangzhou.aliyuncs.com/bank.csv\"),\n        Charset.forName(\"utf8\")).split(\"\\n\"))\n\ncase class Bank(age: Integer, job: String, marital: String, education: String, balance: Integer)\n\nval bank = bankText.map(s => s.split(\";\")).filter(s => s(0) != \"\\\"age\\\"\").map(\n    s => Bank(s(0).toInt, \n            s(1).replaceAll(\"\\\"\", \"\"),\n            s(2).replaceAll(\"\\\"\", \"\"),\n            s(3).replaceAll(\"\\\"\", \"\"),\n            s(5).replaceAll(\"\\\"\", \"\").toInt\n        )\n).toDF()\nbank.registerTempTable(\"bank\")","user":"writer","dateUpdated":"2017-03-21T14:29:15+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"title":true,"enabled":true,"editorMode":"ace/mode/scala","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1423500779206_-1502780787","id":"20150210-015259_1403135953","result":{"code":"SUCCESS","type":"TEXT","msg":"import org.apache.commons.io.IOUtils\nimport java.net.URL\nimport java.nio.charset.Charset\nbankText: org.apache.spark.rdd.RDD[String] = ParallelCollectionRDD[0] at parallelize at <console>:32\ndefined class Bank\nbank: org.apache.spark.sql.DataFrame = [age: int, job: string, marital: string, education: string, balance: int]\n"},"dateCreated":"2015-02-10T01:52:59+0800","dateStarted":"2017-03-21T14:29:15+0800","dateFinished":"2017-03-21T14:29:41+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:82"},{"text":"%sql \nselect age , education , count(1) value\nfrom bank \nwhere age < 30 \ngroup by age ,education\norder by age\n\n\n\n","dateUpdated":"2017-03-17T19:07:28+0800","config":{"colWidth":4,"graph":{"mode":"multiBarChart","height":325,"optionOpen":false,"keys":[{"name":"age","index":0,"aggr":"sum"}],"values":[{"name":"education","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"age","index":0,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1423500782552_-1439281894","id":"20150210-015302_1492795503","result":{"code":"SUCCESS","type":"TABLE","msg":"age\teducation\tvalue\n19\tunknown\t2\n19\tprimary\t1\n19\tsecondary\t1\n20\tsecondary\t3\n21\tsecondary\t6\n21\tunknown\t1\n22\tunknown\t2\n22\tsecondary\t4\n22\tprimary\t1\n22\ttertiary\t2\n23\ttertiary\t4\n23\tsecondary\t11\n23\tunknown\t1\n23\tprimary\t4\n24\tunknown\t2\n24\tprimary\t1\n24\tsecondary\t19\n24\ttertiary\t2\n25\tunknown\t1\n25\tprimary\t2\n25\ttertiary\t17\n25\tsecondary\t24\n26\tprimary\t5\n26\tsecondary\t49\n26\ttertiary\t23\n27\tunknown\t2\n27\tsecondary\t68\n27\ttertiary\t19\n27\tprimary\t5\n28\tprimary\t4\n28\ttertiary\t31\n28\tunknown\t4\n28\tsecondary\t64\n29\tprimary\t3\n29\tunknown\t4\n29\tsecondary\t53\n29\ttertiary\t37\n","comment":"","msgTable":[[{"key":"education","value":"19"},{"key":"education","value":"unknown"},{"key":"education","value":"2"}],[{"key":"value","value":"19"},{"key":"value","value":"primary"},{"key":"value","value":"1"}],[{"value":"19"},{"value":"secondary"},{"value":"1"}],[{"value":"20"},{"value":"secondary"},{"value":"3"}],[{"value":"21"},{"value":"secondary"},{"value":"6"}],[{"value":"21"},{"value":"unknown"},{"value":"1"}],[{"value":"22"},{"value":"unknown"},{"value":"2"}],[{"value":"22"},{"value":"secondary"},{"value":"4"}],[{"value":"22"},{"value":"primary"},{"value":"1"}],[{"value":"22"},{"value":"tertiary"},{"value":"2"}],[{"value":"23"},{"value":"tertiary"},{"value":"4"}],[{"value":"23"},{"value":"secondary"},{"value":"11"}],[{"value":"23"},{"value":"unknown"},{"value":"1"}],[{"value":"23"},{"value":"primary"},{"value":"4"}],[{"value":"24"},{"value":"unknown"},{"value":"2"}],[{"value":"24"},{"value":"primary"},{"value":"1"}],[{"value":"24"},{"value":"secondary"},{"value":"19"}],[{"value":"24"},{"value":"tertiary"},{"value":"2"}],[{"value":"25"},{"value":"unknown"},{"value":"1"}],[{"value":"25"},{"value":"primary"},{"value":"2"}],[{"value":"25"},{"value":"tertiary"},{"value":"17"}],[{"value":"25"},{"value":"secondary"},{"value":"24"}],[{"value":"26"},{"value":"primary"},{"value":"5"}],[{"value":"26"},{"value":"secondary"},{"value":"49"}],[{"value":"26"},{"value":"tertiary"},{"value":"23"}],[{"value":"27"},{"value":"unknown"},{"value":"2"}],[{"value":"27"},{"value":"secondary"},{"value":"68"}],[{"value":"27"},{"value":"tertiary"},{"value":"19"}],[{"value":"27"},{"value":"primary"},{"value":"5"}],[{"value":"28"},{"value":"primary"},{"value":"4"}],[{"value":"28"},{"value":"tertiary"},{"value":"31"}],[{"value":"28"},{"value":"unknown"},{"value":"4"}],[{"value":"28"},{"value":"secondary"},{"value":"64"}],[{"value":"29"},{"value":"primary"},{"value":"3"}],[{"value":"29"},{"value":"unknown"},{"value":"4"}],[{"value":"29"},{"value":"secondary"},{"value":"53"}],[{"value":"29"},{"value":"tertiary"},{"value":"37"}]],"columnNames":[{"name":"age","index":0,"aggr":"sum"},{"name":"education","index":1,"aggr":"sum"},{"name":"value","index":2,"aggr":"sum"}],"rows":[["19","unknown","2"],["19","primary","1"],["19","secondary","1"],["20","secondary","3"],["21","secondary","6"],["21","unknown","1"],["22","unknown","2"],["22","secondary","4"],["22","primary","1"],["22","tertiary","2"],["23","tertiary","4"],["23","secondary","11"],["23","unknown","1"],["23","primary","4"],["24","unknown","2"],["24","primary","1"],["24","secondary","19"],["24","tertiary","2"],["25","unknown","1"],["25","primary","2"],["25","tertiary","17"],["25","secondary","24"],["26","primary","5"],["26","secondary","49"],["26","tertiary","23"],["27","unknown","2"],["27","secondary","68"],["27","tertiary","19"],["27","primary","5"],["28","primary","4"],["28","tertiary","31"],["28","unknown","4"],["28","secondary","64"],["29","primary","3"],["29","unknown","4"],["29","secondary","53"],["29","tertiary","37"]]},"dateCreated":"2015-02-10T01:53:02+0800","dateStarted":"2017-03-17T19:07:28+0800","dateFinished":"2017-03-17T19:07:29+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:83"},{"text":"%sql \nselect age, count(1) value \nfrom bank \nwhere age < ${maxAge=30} \ngroup by age \norder by age","dateUpdated":"2017-03-17T19:07:25+0800","config":{"colWidth":4,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"age","index":0,"aggr":"sum"}],"values":[{"name":"value","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"age","index":0,"aggr":"sum"},"yAxis":{"name":"value","index":1,"aggr":"sum"}}},"enabled":true,"editorHide":false,"tableHide":false},"settings":{"params":{"maxAge":"35"},"forms":{"maxAge":{"name":"maxAge","defaultValue":"30","hidden":false}}},"jobName":"paragraph_1423720444030_-1424110477","id":"20150212-145404_867439529","result":{"code":"SUCCESS","type":"TABLE","msg":"age\tvalue\n19\t4\n20\t3\n21\t7\n22\t9\n23\t20\n24\t24\n25\t44\n26\t77\n27\t94\n28\t103\n29\t97\n30\t150\n31\t199\n32\t224\n33\t186\n34\t231\n","comment":"","msgTable":[[{"key":"value","value":"19"},{"key":"value","value":"4"}],[{"value":"20"},{"value":"3"}],[{"value":"21"},{"value":"7"}],[{"value":"22"},{"value":"9"}],[{"value":"23"},{"value":"20"}],[{"value":"24"},{"value":"24"}],[{"value":"25"},{"value":"44"}],[{"value":"26"},{"value":"77"}],[{"value":"27"},{"value":"94"}],[{"value":"28"},{"value":"103"}],[{"value":"29"},{"value":"97"}],[{"value":"30"},{"value":"150"}],[{"value":"31"},{"value":"199"}],[{"value":"32"},{"value":"224"}],[{"value":"33"},{"value":"186"}],[{"value":"34"},{"value":"231"}]],"columnNames":[{"name":"age","index":0,"aggr":"sum"},{"name":"value","index":1,"aggr":"sum"}],"rows":[["19","4"],["20","3"],["21","7"],["22","9"],["23","20"],["24","24"],["25","44"],["26","77"],["27","94"],["28","103"],["29","97"],["30","150"],["31","199"],["32","224"],["33","186"],["34","231"]]},"dateCreated":"2015-02-12T14:54:04+0800","dateStarted":"2017-03-17T19:07:25+0800","dateFinished":"2017-03-17T19:07:26+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:84"},{"text":"%sql \nselect age, count(1) value \nfrom bank \nwhere marital=\"${marital=single,single|divorced|married}\" \ngroup by age \norder by age","dateUpdated":"2017-03-17T10:58:35+0800","config":{"colWidth":4,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"age","index":0,"aggr":"sum"}],"values":[{"name":"value","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"age","index":0,"aggr":"sum"},"yAxis":{"name":"value","index":1,"aggr":"sum"}}},"enabled":true,"editorHide":false,"tableHide":false},"settings":{"params":{"marital":"single"},"forms":{"marital":{"name":"marital","defaultValue":"single","options":[{"value":"single","$$hashKey":"object:570"},{"value":"divorced","$$hashKey":"object:571"},{"value":"married","$$hashKey":"object:572"}],"hidden":false}}},"jobName":"paragraph_1423836262027_-210588283","id":"20150213-230422_1600658137","result":{"code":"SUCCESS","type":"TABLE","msg":"age\tvalue\n19\t4\n20\t3\n21\t7\n22\t9\n23\t17\n24\t13\n25\t33\n26\t56\n27\t64\n28\t78\n29\t56\n30\t92\n31\t86\n32\t105\n33\t61\n34\t75\n35\t46\n36\t50\n37\t43\n38\t44\n39\t30\n40\t25\n41\t19\n42\t23\n43\t21\n44\t20\n45\t15\n46\t14\n47\t12\n48\t12\n49\t11\n50\t8\n51\t6\n52\t9\n53\t4\n55\t3\n56\t3\n57\t2\n58\t7\n59\t2\n60\t5\n66\t2\n69\t1\n","comment":"","msgTable":[[{"key":"value","value":"19"},{"key":"value","value":"4"}],[{"value":"20"},{"value":"3"}],[{"value":"21"},{"value":"7"}],[{"value":"22"},{"value":"9"}],[{"value":"23"},{"value":"17"}],[{"value":"24"},{"value":"13"}],[{"value":"25"},{"value":"33"}],[{"value":"26"},{"value":"56"}],[{"value":"27"},{"value":"64"}],[{"value":"28"},{"value":"78"}],[{"value":"29"},{"value":"56"}],[{"value":"30"},{"value":"92"}],[{"value":"31"},{"value":"86"}],[{"value":"32"},{"value":"105"}],[{"value":"33"},{"value":"61"}],[{"value":"34"},{"value":"75"}],[{"value":"35"},{"value":"46"}],[{"value":"36"},{"value":"50"}],[{"value":"37"},{"value":"43"}],[{"value":"38"},{"value":"44"}],[{"value":"39"},{"value":"30"}],[{"value":"40"},{"value":"25"}],[{"value":"41"},{"value":"19"}],[{"value":"42"},{"value":"23"}],[{"value":"43"},{"value":"21"}],[{"value":"44"},{"value":"20"}],[{"value":"45"},{"value":"15"}],[{"value":"46"},{"value":"14"}],[{"value":"47"},{"value":"12"}],[{"value":"48"},{"value":"12"}],[{"value":"49"},{"value":"11"}],[{"value":"50"},{"value":"8"}],[{"value":"51"},{"value":"6"}],[{"value":"52"},{"value":"9"}],[{"value":"53"},{"value":"4"}],[{"value":"55"},{"value":"3"}],[{"value":"56"},{"value":"3"}],[{"value":"57"},{"value":"2"}],[{"value":"58"},{"value":"7"}],[{"value":"59"},{"value":"2"}],[{"value":"60"},{"value":"5"}],[{"value":"66"},{"value":"2"}],[{"value":"69"},{"value":"1"}]],"columnNames":[{"name":"age","index":0,"aggr":"sum"},{"name":"value","index":1,"aggr":"sum"}],"rows":[["19","4"],["20","3"],["21","7"],["22","9"],["23","17"],["24","13"],["25","33"],["26","56"],["27","64"],["28","78"],["29","56"],["30","92"],["31","86"],["32","105"],["33","61"],["34","75"],["35","46"],["36","50"],["37","43"],["38","44"],["39","30"],["40","25"],["41","19"],["42","23"],["43","21"],["44","20"],["45","15"],["46","14"],["47","12"],["48","12"],["49","11"],["50","8"],["51","6"],["52","9"],["53","4"],["55","3"],["56","3"],["57","2"],["58","7"],["59","2"],["60","5"],["66","2"],["69","1"]]},"dateCreated":"2015-02-13T23:04:22+0800","dateStarted":"2015-07-03T13:43:33+0800","dateFinished":"2015-07-03T13:43:34+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:85"},{"text":"%md\n## Congratulations, it's done.\n##### You can create your own notebook in 'Notebook' menu. Good luck!","dateUpdated":"2017-03-20T11:12:45+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"editorHide":true,"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1423836268492_216498320","id":"20150213-230428_1231780373","result":{"code":"SUCCESS","type":"HTML","msg":"<h2>Congratulations, it's done.</h2>\n<h5>You can create your own notebook in 'Notebook' menu. Good luck!</h5>\n"},"dateCreated":"2015-02-13T23:04:28+0800","dateStarted":"2015-04-01T21:12:18+0800","dateFinished":"2015-04-01T21:12:18+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:86"},{"text":"%md\n\nAbout bank data:\n\n```\nCitation Request:\n  This dataset is public available for research. The details are described in [Moro et al., 2011]. \n  Please include this citation if you plan to use this database:\n\n  [Moro et al., 2011] S. Moro, R. Laureano and P. Cortez. Using Data Mining for Bank Direct Marketing: An Application of the CRISP-DM Methodology. \n  In P. Novais et al. (Eds.), Proceedings of the European Simulation and Modelling Conference - ESM'2011, pp. 117-121, Guimarães, Portugal, October, 2011. EUROSIS.\n\n  Available at: [pdf] http://hdl.handle.net/1822/14838\n                [bib] http://www3.dsi.uminho.pt/pcortez/bib/2011-esm-1.txt\n```","user":"reader","dateUpdated":"2017-03-21T14:13:19+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"editorHide":true,"enabled":true,"tableHide":false,"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1427420818407_872443482","id":"20150326-214658_12335843","result":{"code":"SUCCESS","type":"HTML","msg":"<p>About bank data:</p>\n<pre><code>Citation Request:\n  This dataset is public available for research. The details are described in [Moro et al., 2011]. \n  Please include this citation if you plan to use this database:\n\n  [Moro et al., 2011] S. Moro, R. Laureano and P. Cortez. Using Data Mining for Bank Direct Marketing: An Application of the CRISP-DM Methodology. \n  In P. Novais et al. (Eds.), Proceedings of the European Simulation and Modelling Conference - ESM'2011, pp. 117-121, Guimarães, Portugal, October, 2011. EUROSIS.\n\n  Available at: [pdf] http://hdl.handle.net/1822/14838\n                [bib] http://www3.dsi.uminho.pt/pcortez/bib/2011-esm-1.txt\n</code></pre>\n"},"dateCreated":"2015-03-26T21:46:58+0800","dateStarted":"2017-03-21T14:13:08+0800","dateFinished":"2017-03-21T14:13:09+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:87"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497880084848_-1465818921","id":"20170619-214804_841834280","dateCreated":"2017-06-19T21:48:04+0800","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1369","text":"%md\n###文件处理","user":"ljj","dateUpdated":"2017-06-19T21:48:22+0800","dateFinished":"2017-06-19T21:48:22+0800","dateStarted":"2017-06-19T21:48:22+0800","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>文件处理</h3>\n"}},{"text":"val data:String=\"\"\"{\"__time__\":1488643447,\"__topic__\":\"\",\"__source__\":\"10.44.205.186\",\"content\":\"120.27.173.16 - - [05/Mar/2017:00:04:07 +0800] \\\"GET /tj.gif?token=lzlh&data=eyJ0eXBlIjoidHJhY2siLCJldmVudCI6InBhZ2V2aWV3IiwidmVyc2lvbiI6IjEuMC4wIiwidGtpZCI6IjE1YTk4MjQyY2ExNDM5LTA3NTJmZTFhMWI1NTc3LTMxNGI3YjVmLTIzMDQwMDAtMTVhOTgyNDJjYWIzOGFlIiwicHJvcGVydGllcyI6eyIkb3MiOiJ3aW5kb3dzIiwiJG1vZGVsIjoicGMiLCIkb3NfdmVyc2lvbiI6IjYuMSIsIiRzY3JlZW5faGVpZ2h0IjoxMjAwLCIkc2NyZWVuX3dpZHRoIjoxOTIwLCIkYnJvd3NlciI6InFxIiwiJGJyb3dzZXJfdmVyc2lvbiI6IjkuNSIsInJlZmVycmVyIjoiaHR0cHM6Ly93d3cudHdvdGlnZXIuY29tL3VzZXIiLCJyZWZlcnJlcl9ob3N0Ijoid3d3LnR3b3RpZ2VyLmNvbSIsInJlZmVycmVyX2RvbWFpbiI6InR3b3RpZ2VyLmNvbSIsInVybCI6Imh0dHBzOi8vd3d3LnR3b3RpZ2VyLmNvbS91c2VyL2ludmVzdGxpc3QiLCJ1cmxfaG9zdCI6Ind3dy50d290aWdlci5jb20iLCJ1cmxfZG9tYWluIjoidHdvdGlnZXIuY29tIn0sIl9ub2NhY2hlIjoiMTMxODgyNTExMTMxOSJ9 HTTP/1.1\\\" 200 0 \\\"https://www.twotiger.com/user/investlist\\\" \\\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.104 Safari/537.36 Core/1.53.2372.400 QQBrowser/9.5.10548.400\\\" 118.247.135.228 0.000\"}\n{\"__time__\":1488643458,\"__topic__\":\"\",\"__source__\":\"10.44.205.186\",\"content\":\"120.27.173.16 - - [05/Mar/2017:00:04:18 +0800] \\\"GET /tj.gif?token=lzlh&data=eyJ0eXBlIjoidHJhY2siLCJldmVudCI6InBhZ2V2aWV3IiwidmVyc2lvbiI6IjEuMC4wIiwidGtpZCI6IjE1YTk4MjQyY2ExNDM5LTA3NTJmZTFhMWI1NTc3LTMxNGI3YjVmLTIzMDQwMDAtMTVhOTgyNDJjYWIzOGFlIiwicHJvcGVydGllcyI6eyIkb3MiOiJ3aW5kb3dzIiwiJG1vZGVsIjoicGMiLCIkb3NfdmVyc2lvbiI6IjYuMSIsIiRzY3JlZW5faGVpZ2h0IjoxMjAwLCIkc2NyZWVuX3dpZHRoIjoxOTIwLCIkYnJvd3NlciI6InFxIiwiJGJyb3dzZXJfdmVyc2lvbiI6IjkuNSIsInJlZmVycmVyIjoiaHR0cHM6Ly93d3cudHdvdGlnZXIuY29tL3VzZXIvaW52ZXN0bGlzdC8yMDE3ITAyITAzLTIwMTchMDMhMDUtbW9udGgtYWxsIiwicmVmZXJyZXJfaG9zdCI6Ind3dy50d290aWdlci5jb20iLCJyZWZlcnJlcl9kb21haW4iOiJ0d290aWdlci5jb20iLCJ1cmwiOiJodHRwczovL3d3dy50d290aWdlci5jb20vdXNlci9pbnZlc3RsaXN0LzIwMTchMDIhMDMtMjAxNyEwMyEwNS1tb250aC1hbGwtMiIsInVybF9ob3N0Ijoid3d3LnR3b3RpZ2VyLmNvbSIsInVybF9kb21haW4iOiJ0d290aWdlci5jb20ifSwiX25vY2FjaGUiOiI3NzY3NDA4ODkwNDc0In0%3D HTTP/1.1\\\" 200 0 \\\"https://www.twotiger.com/user/investlist/2017!02!03-2017!03!05-month-all-2\\\" \\\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.104 Safari/537.36 Core/1.53.2372.400 QQBrowser/9.5.10548.400\\\" 118.247.135.228 0.073\"}\n{\"__time__\":1488643468,\"__topic__\":\"\",\"__source__\":\"10.44.205.186\",\"content\":\"120.27.173.16 - - [05/Mar/2017:00:04:28 +0800] \\\"GET /tj.gif?token=lzlh&data=eyJ0eXBlIjoidHJhY2siLCJldmVudCI6InBhZ2V2aWV3IiwidmVyc2lvbiI6IjEuMC4wIiwidGtpZCI6IjE1YTk4MjQyY2ExNDM5LTA3NTJmZTFhMWI1NTc3LTMxNGI3YjVmLTIzMDQwMDAtMTVhOTgyNDJjYWIzOGFlIiwicHJvcGVydGllcyI6eyIkb3MiOiJ3aW5kb3dzIiwiJG1vZGVsIjoicGMiLCIkb3NfdmVyc2lvbiI6IjYuMSIsIiRzY3JlZW5faGVpZ2h0IjoxMjAwLCIkc2NyZWVuX3dpZHRoIjoxOTIwLCIkYnJvd3NlciI6InFxIiwiJGJyb3dzZXJfdmVyc2lvbiI6IjkuNSIsInJlZmVycmVyIjoiaHR0cHM6Ly93d3cudHdvdGlnZXIuY29tL3VzZXIvaW52ZXN0bGlzdC8yMDE2ITEyITA1LTIwMTchMDMhMDUtdGhyZWVNb250aC1oa3oiLCJyZWZlcnJlcl9ob3N0Ijoid3d3LnR3b3RpZ2VyLmNvbSIsInJlZmVycmVyX2RvbWFpbiI6InR3b3RpZ2VyLmNvbSIsInVybCI6Imh0dHBzOi8vd3d3LnR3b3RpZ2VyLmNvbS91c2VyL2ludmVzdGxpc3QvMjAxNiExMiEwNS0yMDE3ITAzITA1LXRocmVlTW9udGgtYWxsIiwidXJsX2hvc3QiOiJ3d3cudHdvdGlnZXIuY29tIiwidXJsX2RvbWFpbiI6InR3b3RpZ2VyLmNvbSJ9LCJfbm9jYWNoZSI6IjI3ODE0NDgwNDM3MTIifQ%3D%3D HTTP/1.1\\\" 200 0 \\\"https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all\\\" \\\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.104 Safari/537.36 Core/1.53.2372.400 QQBrowser/9.5.10548.400\\\" 118.247.135.228 0.080\"}\n{\"__time__\":1488643469,\"__topic__\":\"\",\"__source__\":\"10.44.205.186\",\"content\":\"120.27.173.16 - - [05/Mar/2017:00:04:29 +0800] \\\"GET /tj.gif?token=lzlh&data=eyJ0eXBlIjoidHJhY2siLCJldmVudCI6InBhZ2V2aWV3IiwidmVyc2lvbiI6IjEuMC4wIiwidGtpZCI6IjE1YTk4MjQyY2ExNDM5LTA3NTJmZTFhMWI1NTc3LTMxNGI3YjVmLTIzMDQwMDAtMTVhOTgyNDJjYWIzOGFlIiwicHJvcGVydGllcyI6eyIkb3MiOiJ3aW5kb3dzIiwiJG1vZGVsIjoicGMiLCIkb3NfdmVyc2lvbiI6IjYuMSIsIiRzY3JlZW5faGVpZ2h0IjoxMjAwLCIkc2NyZWVuX3dpZHRoIjoxOTIwLCIkYnJvd3NlciI6InFxIiwiJGJyb3dzZXJfdmVyc2lvbiI6IjkuNSIsInJlZmVycmVyIjoiaHR0cHM6Ly93d3cudHdvdGlnZXIuY29tL3VzZXIvaW52ZXN0bGlzdC8yMDE2ITEyITA1LTIwMTchMDMhMDUtdGhyZWVNb250aC1hbGwiLCJyZWZlcnJlcl9ob3N0Ijoid3d3LnR3b3RpZ2VyLmNvbSIsInJlZmVycmVyX2RvbWFpbiI6InR3b3RpZ2VyLmNvbSIsInVybCI6Imh0dHBzOi8vd3d3LnR3b3RpZ2VyLmNvbS91c2VyL2ludmVzdGxpc3QvMjAxNiExMiEwNS0yMDE3ITAzITA1LXRocmVlTW9udGgtdHp6IiwidXJsX2hvc3QiOiJ3d3cudHdvdGlnZXIuY29tIiwidXJsX2RvbWFpbiI6InR3b3RpZ2VyLmNvbSJ9LCJfbm9jYWNoZSI6IjcxMjUyOTUxNzUwMTAifQ%3D%3D HTTP/1.1\\\" 200 0 \\\"https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-tzz\\\" \\\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.104 Safari/537.36 Core/1.53.2372.400 QQBrowser/9.5.10548.400\\\" 118.247.135.228 0.073\"}\n{\"__time__\":1488643470,\"__topic__\":\"\",\"__source__\":\"10.44.205.186\",\"content\":\"120.27.173.16 - - [05/Mar/2017:00:04:30 +0800] \\\"GET /tj.gif?token=lzlh&data=eyJ0eXBlIjoidHJhY2siLCJldmVudCI6InBhZ2V2aWV3IiwidmVyc2lvbiI6IjEuMC4wIiwidGtpZCI6IjE1YTk4MjQyY2ExNDM5LTA3NTJmZTFhMWI1NTc3LTMxNGI3YjVmLTIzMDQwMDAtMTVhOTgyNDJjYWIzOGFlIiwicHJvcGVydGllcyI6eyIkb3MiOiJ3aW5kb3dzIiwiJG1vZGVsIjoicGMiLCIkb3NfdmVyc2lvbiI6IjYuMSIsIiRzY3JlZW5faGVpZ2h0IjoxMjAwLCIkc2NyZWVuX3dpZHRoIjoxOTIwLCIkYnJvd3NlciI6InFxIiwiJGJyb3dzZXJfdmVyc2lvbiI6IjkuNSIsInJlZmVycmVyIjoiaHR0cHM6Ly93d3cudHdvdGlnZXIuY29tL3VzZXIvaW52ZXN0bGlzdC8yMDE2ITEyITA1LTIwMTchMDMhMDUtdGhyZWVNb250aC10enoiLCJyZWZlcnJlcl9ob3N0Ijoid3d3LnR3b3RpZ2VyLmNvbSIsInJlZmVycmVyX2RvbWFpbiI6InR3b3RpZ2VyLmNvbSIsInVybCI6Imh0dHBzOi8vd3d3LnR3b3RpZ2VyLmNvbS91c2VyL2ludmVzdGxpc3QvMjAxNiExMiEwNS0yMDE3ITAzITA1LXRocmVlTW9udGgtYWxsIiwidXJsX2hvc3QiOiJ3d3cudHdvdGlnZXIuY29tIiwidXJsX2RvbWFpbiI6InR3b3RpZ2VyLmNvbSJ9LCJfbm9jYWNoZSI6IjY1MTQwNTI2MzY1MzUifQ%3D%3D HTTP/1.1\\\" 200 0 \\\"https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all\\\" \\\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.104 Safari/537.36 Core/1.53.2372.400 QQBrowser/9.5.10548.400\\\" 118.247.135.228 0.073\"}\"\"\"\nval inputData=sc.parallelize(data.split(\"\\n\"))\ninputData.count\ninputData.first()\nprintln(\"@@@@@@@@@@@@@@@@@\")\n//val sqlContext = new org.apache.spark.sql.SQLContext(sc)\nval spark = sqlContext\nimport sqlContext.implicits._\nimport sun.misc.{BASE64Encoder,BASE64Decoder}\nimport java.net.{URLDecoder,URLEncoder}\nimport scala.util.parsing.json.{JSON,JSONObject}\ncase class Properties($os: String, $model: String, $os_version: String, $screen_height: String, $screen_width: String, $browser: String, $browser_version: String, referrer: String, referrer_host: String, referrer_domain: String, url: String, url_host: String, url_domain: String)\ncase class PVData(Type:String, event: String, version: String, tkid: String ,properties: String,_nocache: String)\ncase class PV(tid:String,ip:String,date:String,token:String,data:String)\n//Json.parse\nval jsondata = inputData.map(s => {\n//   var d = s.replaceAll(\"__time__\\\":(\\\\d+),.*content\\\":\\\"(\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+).*\\\\[(\\\\d+/\\\\w+/\\\\d+:\\\\d+:\\\\d+:\\\\d+) \\\\+\\\\d+\\\\].*token=(\\\\w+)&data=(.+) HTTP/.*\", \"$1\\t$2\\t$3\\t$4\\t$5\")\n//   var da=d.split(\"\\t\")\n//   PV(da(0),da(1),da(2),da(3),new String(new BASE64Decoder().decodeBuffer(URLDecoder.decode(da(4), \"UTF-8\"))))\n    var js = s.replaceAll(\".*&data=(.+) HTTP/.*\", \"$1\")\n    var json=new String(new BASE64Decoder().decodeBuffer(URLDecoder.decode(js, \"UTF-8\")))\n    json\n\n  /*\n  val jsono=JSON.parseFull(decoded)\n  JSONObject(Map(\"foo\" -> \"bar\"))//.toString()\n  val encoded = new BASE64Encoder().encode(decoded.getBytes)\n  */\n  //s.replaceAll(\".*__source__\\\":\\\"(.*)\\\",\\\"content\\\":\\\"(.*) - - [(.*)].*token=(.+)&data=(.+) HTTP/.*\", \"$1\\t$2\\t$3\\t$4\\t$5\")\n})\njsondata.count\njsondata.collect.foreach(a=>{println(a);println(\"````````````````\")})\n\n// val pvdata=jsondata.map(_.split(\",\")).map(dd=>PV(dd(0).split(\":\")(1).replaceAll(\"\\\"\", \"\"),dd(1).split(\":\")(1).replaceAll(\"\\\"\", \"\"),dd(2).split(\":\")(1).replaceAll(\"\\\"\", \"\"),dd(3).split(\":\")(1).replaceAll(\"\\\"\", \"\"),dd(4).split(\":\")(1).replaceAll(\"\\\"\", \"\"),dd(5).split(\":\")(1).replaceAll(\"\\\"\", \"\")))\n// pvdata.first\n \n//     val pv=pvdata.toDF()\n//     pv.show()\n//     pv.registerTempTable(\"pv\")\n\nval df = spark.read.json(jsondata)//.as[PV]//.toDF()\ndf.show()\ndf.select(\"properties.*\").show\ndf.select(df(\"tkid\").as(\"id\"),df(\"properties.url\"),df(\"properties.$os\"),df(\"properties.$model\"),df(\"properties.$browser\")).show\ndf.groupBy(\"event\").count().show\n\ndf.registerTempTable(\"pv\")\nspark.sql(\"select tkid id,* From pv where type='track' and event='pageview'\").show()\nspark.sql(\"select tkid id,count(tkid) ids,count(event) trackpv ,count(type) types From pv where type='track' and event='pageview' group by tkid,event,type\").show()\n","user":"ljj","dateUpdated":"2017-04-28T12:27:42+0800","config":{"colWidth":12,"graph":{"mode":"table","height":644,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorHide":false,"tableHide":false,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1435955447812_-158639899","id":"20150703-133047_853701097","result":{"code":"SUCCESS","type":"TEXT","msg":"data: String = \n{\"__time__\":1488643447,\"__topic__\":\"\",\"__source__\":\"10.44.205.186\",\"content\":\"120.27.173.16 - - [05/Mar/2017:00:04:07 +0800] \\\"GET /tj.gif?token=lzlh&data=eyJ0eXBlIjoidHJhY2siLCJldmVudCI6InBhZ2V2aWV3IiwidmVyc2lvbiI6IjEuMC4wIiwidGtpZCI6IjE1YTk4MjQyY2ExNDM5LTA3NTJmZTFhMWI1NTc3LTMxNGI3YjVmLTIzMDQwMDAtMTVhOTgyNDJjYWIzOGFlIiwicHJvcGVydGllcyI6eyIkb3MiOiJ3aW5kb3dzIiwiJG1vZGVsIjoicGMiLCIkb3NfdmVyc2lvbiI6IjYuMSIsIiRzY3JlZW5faGVpZ2h0IjoxMjAwLCIkc2NyZWVuX3dpZHRoIjoxOTIwLCIkYnJvd3NlciI6InFxIiwiJGJyb3dzZXJfdmVyc2lvbiI6IjkuNSIsInJlZmVycmVyIjoiaHR0cHM6Ly93d3cudHdvdGlnZXIuY29tL3VzZXIiLCJyZWZlcnJlcl9ob3N0Ijoid3d3LnR3b3RpZ2VyLmNvbSIsInJlZmVycmVyX2RvbWFpbiI6InR3b3RpZ2VyLmNvbSIsInVybCI6Imh0dHBzOi8vd3d3LnR3b3RpZ2VyLmNvbS91c2VyL2ludmVzdGxpc3QiLCJ1cmxfaG9zdCI6Ind3dy50d290aWdlci5jb20iLCJ1cmxfZG...inputData: org.apache.spark.rdd.RDD[String] = ParallelCollectionRDD[0] at parallelize at <console>:31\nres0: Long = 5\nres1: String = {\"__time__\":1488643447,\"__topic__\":\"\",\"__source__\":\"10.44.205.186\",\"content\":\"120.27.173.16 - - [05/Mar/2017:00:04:07 +0800] \\\"GET /tj.gif?token=lzlh&data=eyJ0eXBlIjoidHJhY2siLCJldmVudCI6InBhZ2V2aWV3IiwidmVyc2lvbiI6IjEuMC4wIiwidGtpZCI6IjE1YTk4MjQyY2ExNDM5LTA3NTJmZTFhMWI1NTc3LTMxNGI3YjVmLTIzMDQwMDAtMTVhOTgyNDJjYWIzOGFlIiwicHJvcGVydGllcyI6eyIkb3MiOiJ3aW5kb3dzIiwiJG1vZGVsIjoicGMiLCIkb3NfdmVyc2lvbiI6IjYuMSIsIiRzY3JlZW5faGVpZ2h0IjoxMjAwLCIkc2NyZWVuX3dpZHRoIjoxOTIwLCIkYnJvd3NlciI6InFxIiwiJGJyb3dzZXJfdmVyc2lvbiI6IjkuNSIsInJlZmVycmVyIjoiaHR0cHM6Ly93d3cudHdvdGlnZXIuY29tL3VzZXIiLCJyZWZlcnJlcl9ob3N0Ijoid3d3LnR3b3RpZ2VyLmNvbSIsInJlZmVycmVyX2RvbWFpbiI6InR3b3RpZ2VyLmNvbSIsInVybCI6Imh0dHBzOi8vd3d3LnR3b3RpZ2VyLmNvbS91c2VyL2ludmVzdGxpc3QiLCJ1cmxfaG9zdCI6Ind3dy50d290aWdlci5jb20iLCJ1cmxfZG9...@@@@@@@@@@@@@@@@@\nspark: org.apache.spark.sql.SQLContext = org.apache.spark.sql.hive.HiveContext@5ae0a955\nimport sqlContext.implicits._\nimport sun.misc.{BASE64Encoder, BASE64Decoder}\nimport java.net.{URLDecoder, URLEncoder}\nimport scala.util.parsing.json.{JSON, JSONObject}\ndefined class Properties\ndefined class PVData\ndefined class PV\njsondata: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[1] at map at <console>:39\nres3: Long = 5\n{\"type\":\"track\",\"event\":\"pageview\",\"version\":\"1.0.0\",\"tkid\":\"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\",\"properties\":{\"$os\":\"windows\",\"$model\":\"pc\",\"$os_version\":\"6.1\",\"$screen_height\":1200,\"$screen_width\":1920,\"$browser\":\"qq\",\"$browser_version\":\"9.5\",\"referrer\":\"https://www.twotiger.com/user\",\"referrer_host\":\"www.twotiger.com\",\"referrer_domain\":\"twotiger.com\",\"url\":\"https://www.twotiger.com/user/investlist\",\"url_host\":\"www.twotiger.com\",\"url_domain\":\"twotiger.com\"},\"_nocache\":\"1318825111319\"}\n````````````````\n{\"type\":\"track\",\"event\":\"pageview\",\"version\":\"1.0.0\",\"tkid\":\"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\",\"properties\":{\"$os\":\"windows\",\"$model\":\"pc\",\"$os_version\":\"6.1\",\"$screen_height\":1200,\"$screen_width\":1920,\"$browser\":\"qq\",\"$browser_version\":\"9.5\",\"referrer\":\"https://www.twotiger.com/user/investlist/2017!02!03-2017!03!05-month-all\",\"referrer_host\":\"www.twotiger.com\",\"referrer_domain\":\"twotiger.com\",\"url\":\"https://www.twotiger.com/user/investlist/2017!02!03-2017!03!05-month-all-2\",\"url_host\":\"www.twotiger.com\",\"url_domain\":\"twotiger.com\"},\"_nocache\":\"7767408890474\"}\n````````````````\n{\"type\":\"track\",\"event\":\"pageview\",\"version\":\"1.0.0\",\"tkid\":\"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\",\"properties\":{\"$os\":\"windows\",\"$model\":\"pc\",\"$os_version\":\"6.1\",\"$screen_height\":1200,\"$screen_width\":1920,\"$browser\":\"qq\",\"$browser_version\":\"9.5\",\"referrer\":\"https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-hkz\",\"referrer_host\":\"www.twotiger.com\",\"referrer_domain\":\"twotiger.com\",\"url\":\"https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all\",\"url_host\":\"www.twotiger.com\",\"url_domain\":\"twotiger.com\"},\"_nocache\":\"2781448043712\"}\n````````````````\n{\"type\":\"track\",\"event\":\"pageview\",\"version\":\"1.0.0\",\"tkid\":\"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\",\"properties\":{\"$os\":\"windows\",\"$model\":\"pc\",\"$os_version\":\"6.1\",\"$screen_height\":1200,\"$screen_width\":1920,\"$browser\":\"qq\",\"$browser_version\":\"9.5\",\"referrer\":\"https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all\",\"referrer_host\":\"www.twotiger.com\",\"referrer_domain\":\"twotiger.com\",\"url\":\"https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-tzz\",\"url_host\":\"www.twotiger.com\",\"url_domain\":\"twotiger.com\"},\"_nocache\":\"7125295175010\"}\n````````````````\n{\"type\":\"track\",\"event\":\"pageview\",\"version\":\"1.0.0\",\"tkid\":\"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\",\"properties\":{\"$os\":\"windows\",\"$model\":\"pc\",\"$os_version\":\"6.1\",\"$screen_height\":1200,\"$screen_width\":1920,\"$browser\":\"qq\",\"$browser_version\":\"9.5\",\"referrer\":\"https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-tzz\",\"referrer_host\":\"www.twotiger.com\",\"referrer_domain\":\"twotiger.com\",\"url\":\"https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all\",\"url_host\":\"www.twotiger.com\",\"url_domain\":\"twotiger.com\"},\"_nocache\":\"6514052636535\"}\n````````````````\ndf: org.apache.spark.sql.DataFrame = [_nocache: string, event: string, properties: struct<$browser:string,$browser_version:string,$model:string,$os:string,$os_version:string,$screen_height:bigint,$screen_width:bigint,referrer:string,referrer_domain:string,referrer_host:string,url:string,url_domain:string,url_host:string>, tkid: string, type: string, version: string]\n+-------------+--------+--------------------+--------------------+-----+-------+\n|     _nocache|   event|          properties|                tkid| type|version|\n+-------------+--------+--------------------+--------------------+-----+-------+\n|1318825111319|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n|7767408890474|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n|2781448043712|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n|7125295175010|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n|6514052636535|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n+-------------+--------+--------------------+--------------------+-----+-------+\n\n+--------+----------------+------+-------+-----------+--------------+-------------+--------------------+---------------+----------------+--------------------+------------+----------------+\n|$browser|$browser_version|$model|    $os|$os_version|$screen_height|$screen_width|            referrer|referrer_domain|   referrer_host|                 url|  url_domain|        url_host|\n+--------+----------------+------+-------+-----------+--------------+-------------+--------------------+---------------+----------------+--------------------+------------+----------------+\n|      qq|             9.5|    pc|windows|        6.1|          1200|         1920|https://www.twoti...|   twotiger.com|www.twotiger.com|https://www.twoti...|twotiger.com|www.twotiger.com|\n|      qq|             9.5|    pc|windows|        6.1|          1200|         1920|https://www.twoti...|   twotiger.com|www.twotiger.com|https://www.twoti...|twotiger.com|www.twotiger.com|\n|      qq|             9.5|    pc|windows|        6.1|          1200|         1920|https://www.twoti...|   twotiger.com|www.twotiger.com|https://www.twoti...|twotiger.com|www.twotiger.com|\n|      qq|             9.5|    pc|windows|        6.1|          1200|         1920|https://www.twoti...|   twotiger.com|www.twotiger.com|https://www.twoti...|twotiger.com|www.twotiger.com|\n|      qq|             9.5|    pc|windows|        6.1|          1200|         1920|https://www.twoti...|   twotiger.com|www.twotiger.com|https://www.twoti...|twotiger.com|www.twotiger.com|\n+--------+----------------+------+-------+-----------+--------------+-------------+--------------------+---------------+----------------+--------------------+------------+----------------+\n\n+--------------------+--------------------+-------+------+--------+\n|                  id|                 url|    $os|$model|$browser|\n+--------------------+--------------------+-------+------+--------+\n|15a98242ca1439-07...|https://www.twoti...|windows|    pc|      qq|\n|15a98242ca1439-07...|https://www.twoti...|windows|    pc|      qq|\n|15a98242ca1439-07...|https://www.twoti...|windows|    pc|      qq|\n|15a98242ca1439-07...|https://www.twoti...|windows|    pc|      qq|\n|15a98242ca1439-07...|https://www.twoti...|windows|    pc|      qq|\n+--------------------+--------------------+-------+------+--------+\n\n+--------+-----+\n|   event|count|\n+--------+-----+\n|pageview|    5|\n+--------+-----+\n\n+--------------------+-------------+--------+--------------------+--------------------+-----+-------+\n|                  id|     _nocache|   event|          properties|                tkid| type|version|\n+--------------------+-------------+--------+--------------------+--------------------+-----+-------+\n|15a98242ca1439-07...|1318825111319|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n|15a98242ca1439-07...|7767408890474|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n|15a98242ca1439-07...|2781448043712|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n|15a98242ca1439-07...|7125295175010|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n|15a98242ca1439-07...|6514052636535|pageview|[qq,9.5,pc,window...|15a98242ca1439-07...|track|  1.0.0|\n+--------------------+-------------+--------+--------------------+--------------------+-----+-------+\n\n+--------------------+---+-------+-----+\n|                  id|ids|trackpv|types|\n+--------------------+---+-------+-----+\n|15a98242ca1439-07...|  5|      5|    5|\n+--------------------+---+-------+-----+\n\n"},"dateCreated":"2015-07-03T13:30:47+0800","dateStarted":"2017-04-28T12:27:42+0800","dateFinished":"2017-04-28T12:28:17+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:88"},{"text":"%sql \nselect tkid,count(1),count(event)\nFrom pv \nwhere type='track' and event='pageview'\ngroup by tkid\norder by tkid","user":"ljj","dateUpdated":"2017-03-21T14:35:20+0800","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"tkid","index":0,"aggr":"sum"}],"values":[{"name":"_c1","index":1,"aggr":"sum"},{"name":"_c2","index":2,"aggr":"sum"}],"groups":[{"name":"_c2","index":2,"aggr":"sum"}],"scatter":{"xAxis":{"name":"tkid","index":0,"aggr":"sum"},"yAxis":{"name":"_c1","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489734330956_-1416357797","id":"20170317-150530_1410932944","result":{"code":"SUCCESS","type":"TABLE","msg":"tkid\t_c1\t_c2\n15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\t5\t5\n","comment":"","msgTable":[[{"key":"_c1","value":"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae"},{"key":"_c1","value":"5"},{"key":"_c1","value":"5"}]],"columnNames":[{"name":"tkid","index":0,"aggr":"sum"},{"name":"_c1","index":1,"aggr":"sum"},{"name":"_c2","index":2,"aggr":"sum"}],"rows":[["15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae","5","5"]]},"dateCreated":"2017-03-17T15:05:30+0800","dateStarted":"2017-03-21T14:35:20+0800","dateFinished":"2017-03-21T14:35:21+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:89"},{"text":"%sql select * from pv","user":"ljj","dateUpdated":"2017-03-21T14:35:25+0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489734349188_920453781","id":"20170317-150549_290508707","result":{"code":"SUCCESS","type":"TABLE","msg":"_nocache\tevent\tproperties\ttkid\ttype\tversion\n1318825111319\tpageview\t[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist,twotiger.com,www.twotiger.com]\t15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\ttrack\t1.0.0\n7767408890474\tpageview\t[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2017!02!03-2017!03!05-month-all,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2017!02!03-2017!03!05-month-all-2,twotiger.com,www.twotiger.com]\t15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\ttrack\t1.0.0\n2781448043712\tpageview\t[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-hkz,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all,twotiger.com,www.twotiger.com]\t15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\ttrack\t1.0.0\n7125295175010\tpageview\t[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-tzz,twotiger.com,www.twotiger.com]\t15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\ttrack\t1.0.0\n6514052636535\tpageview\t[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-tzz,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all,twotiger.com,www.twotiger.com]\t15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae\ttrack\t1.0.0\n","comment":"","msgTable":[[{"key":"event","value":"1318825111319"},{"key":"event","value":"pageview"},{"key":"event","value":"[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist,twotiger.com,www.twotiger.com]"},{"key":"event","value":"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae"},{"key":"event","value":"track"},{"key":"event","value":"1.0.0"}],[{"key":"properties","value":"7767408890474"},{"key":"properties","value":"pageview"},{"key":"properties","value":"[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2017!02!03-2017!03!05-month-all,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2017!02!03-2017!03!05-month-all-2,twotiger.com,www.twotiger.com]"},{"key":"properties","value":"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae"},{"key":"properties","value":"track"},{"key":"properties","value":"1.0.0"}],[{"key":"tkid","value":"2781448043712"},{"key":"tkid","value":"pageview"},{"key":"tkid","value":"[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-hkz,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all,twotiger.com,www.twotiger.com]"},{"key":"tkid","value":"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae"},{"key":"tkid","value":"track"},{"key":"tkid","value":"1.0.0"}],[{"key":"type","value":"7125295175010"},{"key":"type","value":"pageview"},{"key":"type","value":"[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-tzz,twotiger.com,www.twotiger.com]"},{"key":"type","value":"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae"},{"key":"type","value":"track"},{"key":"type","value":"1.0.0"}],[{"key":"version","value":"6514052636535"},{"key":"version","value":"pageview"},{"key":"version","value":"[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-tzz,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all,twotiger.com,www.twotiger.com]"},{"key":"version","value":"15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae"},{"key":"version","value":"track"},{"key":"version","value":"1.0.0"}]],"columnNames":[{"name":"_nocache","index":0,"aggr":"sum"},{"name":"event","index":1,"aggr":"sum"},{"name":"properties","index":2,"aggr":"sum"},{"name":"tkid","index":3,"aggr":"sum"},{"name":"type","index":4,"aggr":"sum"},{"name":"version","index":5,"aggr":"sum"}],"rows":[["1318825111319","pageview","[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist,twotiger.com,www.twotiger.com]","15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae","track","1.0.0"],["7767408890474","pageview","[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2017!02!03-2017!03!05-month-all,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2017!02!03-2017!03!05-month-all-2,twotiger.com,www.twotiger.com]","15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae","track","1.0.0"],["2781448043712","pageview","[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-hkz,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all,twotiger.com,www.twotiger.com]","15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae","track","1.0.0"],["7125295175010","pageview","[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-tzz,twotiger.com,www.twotiger.com]","15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae","track","1.0.0"],["6514052636535","pageview","[qq,9.5,pc,windows,6.1,1200,1920,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-tzz,twotiger.com,www.twotiger.com,https://www.twotiger.com/user/investlist/2016!12!05-2017!03!05-threeMonth-all,twotiger.com,www.twotiger.com]","15a98242ca1439-0752fe1a1b5577-314b7b5f-2304000-15a98242cab38ae","track","1.0.0"]]},"dateCreated":"2017-03-17T15:05:49+0800","dateStarted":"2017-03-21T14:35:25+0800","dateFinished":"2017-03-21T14:35:25+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:90"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489752847223_-936483368","id":"20170317-201407_351488314","dateCreated":"2017-03-17T20:14:07+0800","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:91"}],"name":"Zeppelin Tutorial（模板参考）","id":"2A94M5J1Z","angularObjects":{"2C2S28DWV:shared_process":[],"2C2ME5Z9T:shared_process":[],"2C5726WWP:shared_process":[],"2C4821YPW:shared_process":[],"2C23S4GTE:shared_process":[],"2C4ACB2H6:shared_process":[],"2C3DW3674:shared_process":[],"2C1TKRBKH:shared_process":[],"2C2QRKQWK:shared_process":[],"2C37JBBVP:shared_process":[],"2C293BZQE:shared_process":[],"2C2JAH2VM:shared_process":[],"2C59H7DE9:shared_process":[],"2C3HU9VV7:shared_process":[],"2C3TPUAT4:shared_process":[],"2C3H4C7KJ:shared_process":[],"2C28XTSUU:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}
